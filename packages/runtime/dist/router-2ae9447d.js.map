{"version":3,"file":"router-2ae9447d.js","sources":["../src/util/event-names.mjs","../src/router.mjs"],"sourcesContent":["export const eventNames = Object.freeze({\n  FICUS_APP_SHELL_ERROR: 'ficus.app.shell.error',\n  FICUS_APP_SHELL_IS_OFFLINE: 'ficus.app.shell.is.offline',\n  FICUS_APP_SHELL_OFFLINE: 'ficus.app.shell.offline',\n  FICUS_APP_SHELL_ONLINE: 'ficus.app.shell.online'\n})\n","// @ts-nocheck\nimport { createRouter } from '@ficusjs/router'\nimport { storeNames } from './stores/constants.mjs'\nimport { getAppState, getEventBus } from './util/shell-runtime.mjs'\nimport { eventNames } from './util/event-names.mjs'\n\nfunction getRouterOutletSelector () {\n  return window.ficusShellRuntime && window.ficusShellRuntime.routerOutletSelector\n    ? window.ficusShellRuntime.routerOutletSelector\n    : '#router-outlet'\n}\n\nfunction getRouterMode () {\n  return window.ficusShellRuntime && window.ficusShellRuntime.routerMode\n    ? window.ficusShellRuntime.routerMode\n    : 'hash'\n}\n\nfunction getModuleUrlByLocation (pathname) {\n  const appConfigStore = getAppState(storeNames.APP_CONFIG)\n  return appConfigStore.getModuleUrlByLocation(pathname)\n}\n\nfunction loadModuleByModuleUrl (moduleUrl) {\n  const appConfigStore = getAppState(storeNames.APP_CONFIG)\n  return appConfigStore.loadModuleByModuleUrl(moduleUrl)\n}\n\nexport const router = createRouter([], getRouterOutletSelector(), {\n  autoStart: false,\n  context: { eventBus: getEventBus() },\n  resolveRoute (context, params) {\n    const appConfigStore = getAppState(storeNames.APP_CONFIG)\n    const dataStartPath = appConfigStore.getState('appConfig.data.startPath')\n    if (context.location.pathname === '/' && context.location.pathname !== dataStartPath) {\n      return { redirect: dataStartPath }\n    }\n    if (context.route && typeof context.route.action === 'function') {\n      return context.route.action(context, params)\n    }\n    if (!context.route) {\n      const moduleUrl = getModuleUrlByLocation(context.location.pathname)\n      return moduleUrl\n        ? loadModuleByModuleUrl(moduleUrl).then(() => {\n            if (context.route && typeof context.route.action === 'function') {\n              return context.route.action(context, params)\n            }\n          })\n        : undefined\n    }\n  },\n  errorHandler (error, routeContext) {\n    const moduleUrl = getModuleUrlByLocation(routeContext.location.pathname)\n    if (moduleUrl) {\n      return loadModuleByModuleUrl(moduleUrl).then(() => {\n        if (routeContext.route && typeof routeContext.route.action === 'function') {\n          return routeContext.route.action(routeContext, routeContext.params)\n        }\n      })\n    } else {\n      routeContext.context.eventBus.publish(eventNames.FICUS_APP_SHELL_ERROR, error)\n    }\n  },\n  mode: getRouterMode()\n})\n"],"names":["eventNames","Object","freeze","FICUS_APP_SHELL_ERROR","FICUS_APP_SHELL_IS_OFFLINE","FICUS_APP_SHELL_OFFLINE","FICUS_APP_SHELL_ONLINE","getModuleUrlByLocation","pathname","getAppState","storeNames","APP_CONFIG","loadModuleByModuleUrl","moduleUrl","router","createRouter","window","ficusShellRuntime","routerOutletSelector","autoStart","context","eventBus","getEventBus","resolveRoute","params","dataStartPath","getState","location","redirect","route","action","then","undefined","errorHandler","error","routeContext","publish","mode","routerMode"],"mappings":"4DAAO,MAAMA,EAAaC,OAAOC,OAAO,CACtCC,sBAAuB,wBACvBC,2BAA4B,6BAC5BC,wBAAyB,0BACzBC,uBAAwB,2BCc1B,SAASC,uBAAwBC,GAE/B,OADuBC,EAAYC,EAAWC,YACxBJ,uBAAuBC,EAC/C,CAEA,SAASI,sBAAuBC,GAE9B,OADuBJ,EAAYC,EAAWC,YACxBC,sBAAsBC,EAC9C,CAEY,MAACC,EAASC,EAAa,GArB1BC,OAAOC,mBAAqBD,OAAOC,kBAAkBC,qBACxDF,OAAOC,kBAAkBC,qBACzB,iBAmB4D,CAChEC,WAAW,EACXC,QAAS,CAAEC,SAAUC,KACrBC,aAAcH,EAASI,GACrB,MACMC,EADiBhB,EAAYC,EAAWC,YACTe,SAAS,4BAC9C,GAAkC,MAA9BN,EAAQO,SAASnB,UAAoBY,EAAQO,SAASnB,WAAaiB,EACrE,MAAO,CAAEG,SAAUH,GAErB,GAAIL,EAAQS,OAAyC,mBAAzBT,EAAQS,MAAMC,OACxC,OAAOV,EAAQS,MAAMC,OAAOV,EAASI,GAEvC,IAAKJ,EAAQS,MAAO,CAClB,MAAMhB,EAAYN,uBAAuBa,EAAQO,SAASnB,UAC1D,OAAOK,EACHD,sBAAsBC,GAAWkB,MAAK,KACpC,GAAIX,EAAQS,OAAyC,mBAAzBT,EAAQS,MAAMC,OACxC,OAAOV,EAAQS,MAAMC,OAAOV,EAASI,EACtC,SAEHQ,CACL,CACF,EACDC,aAAcC,EAAOC,GACnB,MAAMtB,EAAYN,uBAAuB4B,EAAaR,SAASnB,UAC/D,GAAIK,EACF,OAAOD,sBAAsBC,GAAWkB,MAAK,KAC3C,GAAII,EAAaN,OAA8C,mBAA9BM,EAAaN,MAAMC,OAClD,OAAOK,EAAaN,MAAMC,OAAOK,EAAcA,EAAaX,OAC7D,IAGHW,EAAaf,QAAQC,SAASe,QAAQpC,EAAWG,sBAAuB+B,EAE3E,EACDG,KAlDOrB,OAAOC,mBAAqBD,OAAOC,kBAAkBqB,WACxDtB,OAAOC,kBAAkBqB,WACzB"}