function toKebabCase(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}function elementRenderer(t,e){for(;e.firstChild;)e.removeChild(e.firstChild);let s;if("string"==typeof t)s=document.createElement("div"),s.innerHTML=t;else{if(!t.nodeName)throw new Error(`Unable to render ${t}. Have you included a renderer function?`);s=t}s&&e.appendChild(s)}class t{constructor(){if(globalThis.__ficusjs__&&globalThis.__ficusjs__.eventBus)return globalThis.__ficusjs__.eventBus;this.subscribers={},globalThis.__ficusjs__=globalThis.__ficusjs__||{},globalThis.__ficusjs__.eventBus=globalThis.__ficusjs__.eventBus||this}getSubscribers(t){return t?this.subscribers[t]:this.subscribers}subscribe(t,e,s={}){const r=this,n={callCount:0,fireOnce:!1,...s};return r.subscribers[t]||(r.subscribers[t]=new Map),r.subscribers[t].set(e,n),()=>{const s=new Map;r.subscribers[t].forEach(((t,r)=>r!==e&&s.set(r,t))),r.subscribers[t]=s}}publish(t,e){if(!this.subscribers[t])return[];const s=new Map;return this.subscribers[t].forEach(((t,r)=>{t.fireOnce&&1===t.callCount||(r(e),++t.callCount,s.set(r,t))})),s}}function getEventBus(){return new t}class e{constructor(){if(globalThis.__ficusjs__&&globalThis.__ficusjs__.i18n)return globalThis.__ficusjs__.i18n;this.registry={},this.currentLocale="en",this.interpolateRE=/{{\s*(\w+)\s*}}/g,this.pluralizationRules={en:{pluralizeTo:"count",getVariationIndex:t=>1===t?0:1}},this._init(),globalThis.__ficusjs__=globalThis.__ficusjs__||{},globalThis.__ficusjs__.i18n=globalThis.__ficusjs__.i18n||this}_init(){if("undefined"!=typeof window&&"undefined"!=typeof document){const t=new URLSearchParams(window.location.search).get("lang")||(document.documentElement.lang?document.documentElement.lang:navigator.language);t&&this.setLocale(t)}}_translatePlural(t,e,s,r,n){const i=this.pluralizationRules[r],o=Object.keys(s),a=1===o.length?o[0]:n||i.pluralizeTo,c=parseFloat(s[a]);if(isNaN(c))throw new Error(`Translation pluralization missing parameters on key '${t}'`);return this._interpolate(e[i.getVariationIndex(c)],s)}_interpolate(t,e){return e?t.replace(this.interpolateRE,(function(t,s){return null!=e[s]?e[s]:t})):t}t(t,e,s){const r=(s=s||{}).locale||this.currentLocale,n=s.registry||this.registry,i=n[r]&&n[r][t];return void 0===i?this.whenUndefined(t,r):Array.isArray(i)?this._translatePlural(t,i,e,r,s.pluralizeTo):this._interpolate(i,e)}add(t,e,s){return e=e||this.currentLocale,this.registry[e]=this.registry[e]||{},Object.keys(t).forEach((r=>{const n=t[r],i=s?s+"."+r:r,o=typeof n;Array.isArray(n)||"string"===o||"number"===o?this.registry[e][i]=n:this.add(n,e,i)})),this}setLocale(t){return this.currentLocale=t,this}getLocale(){return this.currentLocale}interpolateWith(t){return this.interpolateRE=t,this}setPluralizationRule(t,e,s){return this.pluralizationRules[t]={pluralizeTo:s&&(s.pluralizeTo||"count"),getVariationIndex:e},this}whenUndefined(t,e){return t}clear(){return this.registry={},this}}const waitFor=(t=(()=>!0),e=1e4)=>new Promise(((s,r)=>{const check=()=>{const n=t();n?s(n):(e-=100)<0?r(new Error("Timed out waiting!")):setTimeout(check,100)};setTimeout(check,100)}));function isPromise$1(t){return("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then}function hasKey(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function elementEmpty(t){for(;t.firstChild;)t.removeChild(t.firstChild)}let s=class extends Array{peek(){return this[this.length-1]}};function flatten(t,e,s,r=!0){s.forEach((s=>{if(s.children)!function(t,e,s){let r,n=[...s.children];if(s.action||s.component)r={...s},delete r.children;else{const t=n.find((t=>""===t.path));t&&(r={...t},r.path=s.path,delete r.children,n=n.filter((t=>""!==t.path)))}const i=copyRouteAndAdjustPath(r,e);t.push(i),e.push(i),flatten(t,e,n,!1)}(t,e,s);else{const r=copyRouteAndAdjustPath(s,e);t.push(r)}r&&e.splice(0,e.length)}))}function copyRouteAndAdjustPath(t,e){const s={...t},r=e.peek();return r&&(s.path=`${r.path}${s.path}`),s}function stripTrailingSlash(t){return"/"===t.charAt(t.length-1)?t.slice(0,-1):t}function addMatcherToRoute(t){const e={...t,matcher:e=>stripTrailingSlash(t.path)===stripTrailingSlash(e)?e:void 0};if(t.component&&!t.action&&(e.action=()=>t.component),/:[^/]+/.test(t.path)){const s=t.path.match(/(:[^/]+)/gm);s&&s.length>0&&(e.urlParamKeys=s.map((t=>t.substring(1))));const r=stripTrailingSlash(t.path.replace(/:[^/]+/g,"([^/]+)"));e.pathRegex=new RegExp(`^${r}$`),e.pathRegexCapture=new RegExp(r,"gm"),e.matcher=t=>{if(e.pathRegex.test(t)){const s={};let r;for(;null!==(r=e.pathRegexCapture.exec(t));)if(r&&r.length===e.urlParamKeys.length+1){const t=r.slice(1);for(let r=0;r<t.length;r++)s[e.urlParamKeys[r]]=t[r]}return s}}}return e}class r{constructor(t){let e,s;this.urlParamMap={};let r=[];t.includes("?")?(e=t.substring(t.indexOf("?")+1),e.includes("#")&&(e=e.substring(0,e.indexOf("#")),s=e.substring(e.indexOf("#")+1))):t.includes("#")&&(e="",s=t.substring(t.indexOf("#")+1,t.length)),r=e?e.split("&"):[],s&&s.includes("&")&&s.includes("=")&&(r=[...r,...s.split("&")]);for(let t=0;t<r.length;t++){const e=r[t].split("=");2===e.length&&(this.urlParamMap[e[0]]=this._esc(decodeURIComponent(e[1])))}}entries(){let t=[];for(const e in this.urlParamMap)this.has(e)&&t.push([e,this.urlParamMap[e]]);return t=t.sort((function(t,e){return t[0].toLowerCase()>e[0].toLowerCase()?1:t[0].toLowerCase()<e[0].toLowerCase()?-1:0})),t}remove(t){delete this.urlParamMap[t]}get(t){return this.urlParamMap[t]}has(t){return this.urlParamMap.hasOwnProperty(t)}keys(){const t=[];for(const e in this.urlParamMap)this.has(e)&&t.push(e);return t}set(t,e){this.urlParamMap[t]=e}toString(){let t="";const e=this.entries();for(let s=0;s<e.length;s++){const r=e[s];this.has(r[0])&&(t+="&"+r[0]+"="+encodeURIComponent(this._unesc(r[1])))}return t.substring(1)}values(){const t=[];for(const e in this.urlParamMap)this.has(e)&&t.push(this.urlParamMap[e]);return t}_esc(t){return String(t).replace(/</g,"&lt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/>/g,"&gt;").replace(/&/g,"&amp;")}_unesc(t){return String(t).replace(/&lt;/g,"<").replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&amp;/g,"&")}}class n{constructor(){this.items=[]}push(t){this.items.push(t)}pop(){this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return 0===this.items.length}clear(){this.items=[]}size(){return this.items.length}}class i{constructor(t,e,s){if("undefined"!=typeof window&&window.__ficusjs__&&window.__ficusjs__.router)return window.__ficusjs__.router;this._rootOutletSelector=e,this.stack=new n,this._routes=this._processRoutes(t),this._routerOptions=this._processOptions(s),this._outletCache=new WeakMap,"undefined"!=typeof window&&(window.addEventListener("popstate",(()=>{this._findAndRenderRoute(this.location).then((()=>this.stack.pop())).catch((t=>{throw this._renderError(this.location,t),t}))})),window.__ficusjs__=window.__ficusjs__||{},window.__ficusjs__.router=window.__ficusjs__.router||this)}get location(){let t;return"undefined"!=typeof window&&(t={host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:window.location.hash,href:window.location.href,search:window.location.search,state:window.history.state},"hash"===this._routerOptions.mode&&(t.pathname=this._getHashPathname(),t.hash="")),t}get options(){return this._routerOptions}setOptions(t={}){this._routerOptions=this._processOptions(t)}addRoutes(t){this._routes=[...this._routes,...this._processRoutes(t)]}hasRoute(t){return!!this._findRoute(t)}_getQueryStringParams(t){return Object.fromEntries(new r(t.href).entries())}_getUrlParams(t,e){const s=e.matcher(t.pathname);return"string"==typeof s?void 0:s}_findRoute(t){return this._routes.find((e=>void 0!==e.matcher(t)))}_getHashPathname(){let t=window.location.hash.substring(1);return""===t&&(t="/"),t}_processRoutes(t){return function(t){const e=new s;return flatten(e,new s,t),e}(t).map((t=>addMatcherToRoute(t)))}_processOptions(t={}){const e=this,s={mode:"history",autoStart:!0,changeHistoryState:!0,warnOnMissingOutlets:!1,...t};if(!s.resolveRoute)return{...s,resolveRoute(t,s){if(t.route&&"function"==typeof t.route.action)return{template:new Promise(((e,r)=>{e(t.route.action(t,s))})).catch((s=>{throw e._renderError(t.location,s),s})),outlets:t.route.outlets}}};if(s.resolveRoute){const t=s.resolveRoute;return{...s,resolveRoute:(e,s)=>t(e,s)}}return s}_render(t,e,s,r={}){return isPromise$1(s)?s.then((s=>this._performRender(t,e,s,r))):this._performRender(t,e,s,r)}_performRender(t,e,s,r){return"object"==typeof s&&s.redirect?Promise.resolve(s):s instanceof Error?(this._renderError(t,s),Promise.resolve(!0)):!1===s?Promise.resolve(!1):waitFor((()=>document.querySelector(this._rootOutletSelector))).then((()=>{const t=document.querySelector(this._rootOutletSelector),n=Object.keys(r),i=document.querySelectorAll("[data-router-outlet]:not([sticky])");return i.length&&[...i].filter((e=>e!==t)).forEach((t=>elementEmpty(t))),this._renderIntoOutlet(s,t),n.length?Promise.all(n.map((t=>waitFor((()=>{const e=document.querySelectorAll(t);return e.length>0&&e})).then((s=>{const n=r[t](e,e&&e.params);isPromise$1(n)?n.then((t=>this._renderIntoAllOutlets(t,s))):this._renderIntoAllOutlets(n,s)})).catch((t=>this._routerOptions.warnOnMissingOutlets&&console.warn(t)))))).then((()=>!0)):Promise.resolve(!0)}))}_renderIntoOutlet(t,e){t&&(this._isSameOutletContent(t,e)||(function(t,e){const s="string"==typeof e?document.querySelector(e):e;if(!s)return void console.warn(`Unable to find outlet: ${e}`);let r;r=function(t){return t instanceof Element||t instanceof HTMLElement}(t)?t:window.customElements.get(t)?document.createElement(t):function(t){const e=document.createElement("div");return e.innerHTML=t.trim(),e.firstChild}(t),elementEmpty(s),s.appendChild(r);const n="data-router-outlet";s.hasAttribute(n)||s.setAttribute(n,"")}(t,e),this._outletCache.set(e,t),this._emitRouterOutletChangeEvent(e)))}_renderIntoAllOutlets(t,e){for(let s=0;s<e.length;s++){const r=e[s];this._renderIntoOutlet(t,r)}}_emitRouterOutletChangeEvent(t){!function(t,e,s={}){const r=Object.assign({},{bubbles:!0,cancelable:!0,composed:!1},s),n=new CustomEvent(e,r);t.dispatchEvent(n)}(t,"outlet-change",{detail:{outlet:t}})}_isSameOutletContent(t,e){return!("string"!=typeof t||!this._outletCache.has(e)||this._outletCache.get(e)!==t)}push(t,e){return this._navigate(t,e)}replace(t,e){return this._navigate(t,e,!0)}_navigate(t,e,s=!1){const r=this._normalizeLocation(t);if(!s&&r.pathname===this.location.pathname)return Promise.resolve();const{actionResult:n,context:i}=this._resolveRoute(r);if(null==n){this._routerOptions.changeHistoryState&&this._setState(r.href,e,s);const t=new Error("not_found");return this._renderError(r,t),Promise.reject(t)}if("object"==typeof n&&n.redirect){const e={from:t};return n.redirect!==this.location.pathname?this.push(n.redirect,e):Promise.resolve()}return n instanceof Error?(this._routerOptions.changeHistoryState&&this._setState(r.href,e,s),this._renderError(r,n),Promise.reject(n)):!1===n?Promise.resolve():this._renderActionResult(r,i,n,e,s).then((t=>{if("object"==typeof t&&t.redirect){const e={from:r.href};return this.push(t.redirect,e)}return t&&this._routerOptions.changeHistoryState&&this._setState(r.href,e,s),Promise.resolve(t)})).catch((t=>{throw this._renderError(r,t),t}))}_normalizeLocation(t){const e={host:void 0,protocol:void 0,href:void 0,pathname:void 0,search:void 0,hash:void 0};if("object"==typeof t){if("history"===this._routerOptions.mode&&!t.pathname)throw new Error(`Unable to navigate to: ${t}`);let s=t.href||this.location.href;e.pathname=t.pathname||this.location.pathname,t.search&&""!==t.search&&!s.includes(t.search)&&(s=`${s}${t.search}`,e.search=t.search),t.hash&&""!==t.hash&&!s.includes(t.hash)&&(s=`${s}${t.hash}`,e.hash=t.hash),e.hash=t.hash||this.location.hash,e.search=t.search||this.location.search,e.host=t.host||this.location.host,e.protocol=t.protocol||this.location.protocol,e.href=s}else if("string"==typeof t){const s=new URL(/^https?:\/\//.test(t)?t:`${window.location.protocol}//${window.location.host}${t}`);e.host=s.host,e.protocol=s.protocol,e.href=s.href,e.pathname=s.pathname,e.search=s.search,e.hash=s.hash,t.includes("?")?(e.pathname=t.substring(0,t.indexOf("?")),e.search=t.substring(t.indexOf("?"))):t.includes("#")&&(e.pathname=t.substring(0,t.indexOf("#")))}return"hash"===this._routerOptions.mode&&(e.href=`${window.location.pathname}${e.search||""}#${e.pathname}`),e}_renderActionResult(t,e,s){if(hasKey(s,"template")&&hasKey(s,"outlets")){const{template:r,outlets:n}=s;return this._render(t,e,r,n)}return this._render(t,e,s,{})}_getRouteContext(t,e){let s={...this._getQueryStringParams(e)};const r={context:this._routerOptions.context,router:this,route:t,location:e,params:s};return t&&(s={...s,...this._getUrlParams(e,t)},r.params=s),r}_resolveRoute(t){const e=this._findRoute(t.pathname),s=this._getRouteContext(e,t);try{const t=this._routerOptions.resolveRoute(s,s.params);return null!=t?{actionResult:t,context:s}:e?{actionResult:e.action(s,s.params),context:s}:{actionResult:void 0,context:s}}catch(e){throw this._renderError(t,e),e}}_findAndRenderRoute(t){const{actionResult:e,context:s}=this._resolveRoute(t);if(!e)throw new Error("not_found");return this._renderActionResult(t,s,e)}_setState(t,e,s=!1){s?window.history.replaceState(e,null,t):(this.stack.push(t),window.history.pushState(e,null,t))}_renderError(t,e){if(console.error(`A router error occurred for location '${t.href}'`,e),this._routerOptions.errorHandler){const s={message:e.message,status:"not_found"===e.message?404:500},r=this._getRouteContext(this._findRoute(t.pathname),t),n=this._routerOptions.errorHandler(s,r);isPromise$1(n)?n.then((e=>this._render(t,r,e))).catch((s=>this._render(t,r,`<div><strong>Router error from <code>errorHandler</code></strong>: ${s.message}, original error: ${e.message}</div>`))):this._render(t,r,n)}else this._render(t,null,`<div><strong>Router error</strong>: ${e.message}</div>`)}go(t){window.history.go(t)}goBack(){this.go(-1)}goForward(){this.go(1)}start(t=this.location){/complete|interactive|loaded/.test(document.readyState)?this.replace(t):document.addEventListener("DOMContentLoaded",(()=>this.replace(t)))}}function createRouter(t,e,s={}){const r=new i(t,e,s);return r.options.autoStart&&r.start(),r}function getRouter(){if("undefined"!=typeof window&&window.__ficusjs__&&window.__ficusjs__.router)return window.__ficusjs__.router}class o{constructor(t,e,s={}){this.namespace=t,this.storage=e,this.options=s,this._init()}_init(){if("performance"in globalThis&&this.options.clearOnReload){const t=globalThis.performance.getEntriesByType("navigation").map((t=>t.type));this.lastUpdated()&&t.includes("reload")&&this.removeState()}}setState(t){t?(this.storage.setItem(`${this.namespace}:state`,this._normalizeState(t)),this.storage.setItem(`${this.namespace}:lastUpdated`,(new Date).getTime().toString())):this.removeState()}_normalizeState(t){return"object"==typeof t&&this.options.saveState&&"function"==typeof this.options.saveState?JSON.stringify(this.options.saveState(t)):"string"!=typeof t?JSON.stringify(t):t}getState(){const t=this.storage.getItem(`${this.namespace}:state`);return t?JSON.parse(t):void 0}lastUpdated(){const t=this.storage.getItem(`${this.namespace}:lastUpdated`);return t?parseInt(t,10):void 0}removeState(){this.storage.removeItem(`${this.namespace}:state`),this.storage.removeItem(`${this.namespace}:lastUpdated`)}}function createPersist(t,e="session",s){return new o(t,"local"===e?globalThis.localStorage:globalThis.sessionStorage,s)}function isPromise(t){return("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then}class a{constructor(t){const e=this;e.state={},e.getterCache={},e.status="resting",e.transaction=!1,e.transactionCache={},e.callbacks=[],this._processActions(t);let s=t.initialState||{};if(e.copyOfInitialState=e._copyValue(s),e.ttl=-1,e.lastUpdatedState={},t.ttl&&(e.ttl=t.ttl,Object.keys(e.copyOfInitialState).forEach((t=>e.lastUpdatedState[t]=(new Date).getTime()))),e.persist=void 0,t.persist){e.persist="string"==typeof t.persist?createPersist(t.persist):t.persist;const r=e.persist.getState(),n=e.persist.lastUpdated();r&&n&&(-1===e.ttl||e._lastUpdatedTimeDiff(n)<e.ttl)&&(s=r)}this._processState(s)}_processActions(t){const e=this,s=Object.keys(t);s.length&&s.forEach((s=>{e[s]||"function"!=typeof t[s]||(e[s]=t[s].bind(e))}))}_processState(t){const e=this;e.state=new Proxy(t,{set:(t,s,r)=>(e.transaction&&!e.transactionCache[s]&&(e.transactionCache[s]=e._copyValue(t[s])),t[s]=r,e.lastUpdatedState[s]=(new Date).getTime(),e.getterCache={},e.transaction||(e.persist&&e.persist.setState(e.state),e.status="resting",e._processCallbacks(e.state)),!0),get:(t,s)=>e.ttl>-1&&e._lastUpdatedTimeDiff(e.lastUpdatedState[s])>e.ttl?(e.persist&&e.persist.removeState(),e.copyOfInitialState[s]):t[s]})}_lastUpdatedTimeDiff(t){return Math.round((new Date).getTime()-t)}setState(t){const setter=t=>{if(!t||"object"!=typeof t)return;const e=this.transaction;e||(this.transactionCache={},this.transaction=!0);for(const e in t)this.state[e]&&this.state[e]===t[e]||(this.state[e]=t[e]);e||(this.transaction=!1,this.persist&&this.persist.setState(this.state),this._processCallbacks(this.state))},e=t(this.state);isPromise(e)?e.then(setter):setter(e)}getState(t){if(t&&("string"==typeof t||"function"==typeof t)){if(!this.getterCache[t]){let e;if(e="function"==typeof t?t(this.state):(Array.isArray(t)?t:t.match(/([^[.\]])+/g)).reduce(((t,e)=>t&&t[e]),this.state),null==e)return;this.getterCache[t]=e}return this.getterCache[t]}}_processCallbacks(t){return!!this.callbacks.length&&(this.callbacks.forEach((e=>e(t))),!0)}subscribe(t){if("function"!=typeof t)throw new Error("Dude, you can only subscribe to store changes with a valid function");return this.callbacks.includes(t)||this.callbacks.push(t),()=>{this.callbacks=this.callbacks.filter((e=>e!==t))}}_copyValue(t){return t?JSON.parse(JSON.stringify(t)):t}clear(t=!0){this.getterCache={},this.transactionCache={},this.lastUpdatedState={},this.persist&&this.persist.removeState(),this.transaction=!0,this.status="clear";const e=this._copyValue(this.copyOfInitialState);for(const t in e)this.state[t]=e[t];this.transaction=!1,this.status="resting",t&&this._processCallbacks(this.state)}}function createAppState(t,e){let s=getAppState$1(t);return s||(s=new a(e),globalThis.__ficusjs__=globalThis.__ficusjs__||{},globalThis.__ficusjs__.store=globalThis.__ficusjs__.store||{},globalThis.__ficusjs__.store[t]=s,s)}function getAppState$1(t){if(globalThis.__ficusjs__&&globalThis.__ficusjs__.store&&globalThis.__ficusjs__.store[t])return globalThis.__ficusjs__.store[t]}function wrapXStateService(t,e,s){const r={_xstateService:t,_getterCache:{},_persist:"string"==typeof s?createPersist(s):s,get status(){return this._xstateService?this._xstateService.status:c.INIT},get state(){return this._xstateService.state},subscribe(t){return this._xstateService.subscribe((()=>{this._getterCache={},this._persist&&this._xstateService.status===c.RUNNING&&this._persist.setState(this._xstateService.state),t()}))},send(t){this._xstateService.send(t)},start(){this._xstateService.start(this._persist?this._persist.getState():void 0)}};return e&&(r.getters=new Proxy(e,{get(t,e){if(!r._getterCache[e]){const s=t[e](r._xstateService.state.context);r._getterCache[e]=s}return r._getterCache[e]}})),r}const c=Object.freeze({INIT:-1,NOT_STARTED:0,RUNNING:1,STOPPED:2});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function t$1(t,e){var s="function"==typeof Symbol&&t[Symbol.iterator];if(!s)return t;var r,n,i=s.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(t){n={error:t}}finally{try{r&&!r.done&&(s=i.return)&&s.call(i)}finally{if(n)throw n.error}}return o}var l;!function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"}(l||(l={}));var u={type:"xstate.init"};function r$1(t){return void 0===t?[]:[].concat(t)}function o$1(t,e){return"string"==typeof(t="string"==typeof t&&e&&e[t]?e[t]:t)?{type:t}:"function"==typeof t?{type:t.name,exec:t}:t}function a$1(t){return function(e){return t===e}}function u$1(t){return"string"==typeof t?{type:t}:t}function c$1(t,e){return{value:t,context:e,actions:[],changed:!1,matches:a$1(t)}}function f$1(t,e,s){var r=e,n=!1;return[t.filter((function(t){if("xstate.assign"===t.type){n=!0;var e=Object.assign({},r);return"function"==typeof t.assignment?e=t.assignment(r,s):Object.keys(t.assignment).forEach((function(n){e[n]="function"==typeof t.assignment[n]?t.assignment[n](r,s):t.assignment[n]})),r=e,!1}return!0})),r,n]}var l$1=function(t,e){return t.actions.forEach((function(s){var r=s.exec;return r&&r(t.context,e)}))};class h extends Map{set(t,e){return super.set(t,e),e}}class d extends WeakMap{set(t,e){return super.set(t,e),e
/*! (c) Andrea Giammarchi - ISC */}}const p=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,f=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/?)>/g,_=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,m=/[\x01\x02]/g,diffable=(t,e)=>111===t.nodeType?1/e<0?e?(({firstChild:t,lastChild:e})=>{const s=document.createRange();return s.setStartAfter(t),s.setEndAfter(e),s.deleteContents(),t})(t):t.lastChild:e?t.valueOf():t.firstChild:t,{isArray:g}=Array,getValue=t=>null==t?t:t.valueOf(),event=(t,e)=>{let s,r,n=e.slice(2);return!(e in t)&&(r=e.toLowerCase())in t&&(n=r.slice(2)),e=>{const r=g(e)?e:[e,!1];s!==r[0]&&(s&&t.removeEventListener(n,s,r[1]),(s=r[0])&&t.addEventListener(n,s,r[1]))}},{isArray:b,prototype:y}=Array,{indexOf:v}=y,{createDocumentFragment:S,createElement:w,createElementNS:C,createTextNode:T,createTreeWalker:R,importNode:j}=new Proxy(document,{get:(t,e)=>t[e].bind(t)});let O;const createContent=(t,e)=>e?(t=>{O||(O=C("http://www.w3.org/2000/svg","svg")),O.innerHTML=t;const e=S();return e.append(...O.childNodes),e})(t):(t=>{const e=w("template");return e.innerHTML=t,e.content})(t),reducePath=({childNodes:t},e)=>t[e],diff=(t,e,s)=>((t,e,s,r,n)=>{const i=s.length;let o=e.length,a=i,c=0,l=0,u=null;for(;c<o||l<a;)if(o===c){const e=a<i?l?r(s[l-1],-0).nextSibling:r(s[a-l],0):n;for(;l<a;)t.insertBefore(r(s[l++],1),e)}else if(a===l)for(;c<o;)u&&u.has(e[c])||t.removeChild(r(e[c],-1)),c++;else if(e[c]===s[l])c++,l++;else if(e[o-1]===s[a-1])o--,a--;else if(e[c]===s[a-1]&&s[l]===e[o-1]){const n=r(e[--o],-1).nextSibling;t.insertBefore(r(s[l++],1),r(e[c++],-1).nextSibling),t.insertBefore(r(s[--a],1),n),e[o]=s[a]}else{if(!u){u=new Map;let t=l;for(;t<a;)u.set(s[t],t++)}if(u.has(e[c])){const n=u.get(e[c]);if(l<n&&n<a){let i=c,h=1;for(;++i<o&&i<a&&u.get(e[i])===n+h;)h++;if(h>n-l){const i=r(e[c],0);for(;l<n;)t.insertBefore(r(s[l++],1),i)}else t.replaceChild(r(s[l++],1),r(e[c++],-1))}else c++}else t.removeChild(r(e[c++],-1))}return s})(t.parentNode,e,s,diffable,t);function handlers(t){const{type:e,path:s}=t,r=s.reduceRight(reducePath,this);return"node"===e?(t=>{let e,s,r=[];const anyContent=n=>{switch(typeof n){case"string":case"number":case"boolean":e!==n&&(e=n,s||(s=T("")),s.data=n,r=diff(t,r,[s]));break;case"object":case"undefined":if(null==n){e!=n&&(e=n,r=diff(t,r,[]));break}if(b(n)){e=n,0===n.length?r=diff(t,r,[]):"object"==typeof n[0]?r=diff(t,r,n):anyContent(String(n));break}if(e!==n)if("ELEMENT_NODE"in n)e=n,r=diff(t,r,11===n.nodeType?[...n.childNodes]:[n]);else{const t=n.valueOf();t!==n&&anyContent(t)}break;case"function":anyContent(n(t))}};return anyContent})(r):"attr"===e?((t,e)=>{switch(e[0]){case"?":return((t,e,s)=>r=>{const n=!!getValue(r);s!==n&&((s=n)?t.setAttribute(e,""):t.removeAttribute(e))})(t,e.slice(1),!1);case".":return((t,e)=>"dataset"===e?(({dataset:t})=>e=>{for(const s in e){const r=e[s];null==r?delete t[s]:t[s]=r}})(t):s=>{t[e]=s})(t,e.slice(1));case"@":return event(t,"on"+e.slice(1));case"o":if("n"===e[1])return event(t,e)}switch(e){case"ref":return(t=>{let e;return s=>{e!==s&&(e=s,"function"==typeof s?s(t):s.current=t)}})(t);case"aria":return(t=>e=>{for(const s in e){const r="role"===s?s:`aria-${s}`,n=e[s];null==n?t.removeAttribute(r):t.setAttribute(r,n)}})(t)}return((t,e)=>{let s,r=!0;const n=document.createAttributeNS(null,e);return e=>{const i=getValue(e);s!==i&&(null==(s=i)?r||(t.removeAttributeNode(n),r=!0):(n.value=i,r&&(t.setAttributeNodeNS(n),r=!1)))}})(t,e)})(r,t.name):(t=>{let e;return s=>{const r=getValue(s);e!=r&&(e=r,t.textContent=null==r?"":r)}})(r)}const createPath=t=>{const e=[];let{parentNode:s}=t;for(;s;)e.push(v.call(s.childNodes,t)),t=s,({parentNode:s}=t);return e},x=new d,E=/^(?:textarea|script|style|title|plaintext|xmp)$/,mapTemplate=(t,e)=>{const s="svg"===t,r=((t,e,s)=>{let r=0;return t.join("").trim().replace(f,((t,e,r,n)=>{let i=e+r.replace(_,"=$2$1").trimEnd();return n.length&&(i+=s||p.test(e)?" /":"></"+e),"<"+i+">"})).replace(m,(t=>""===t?"\x3c!--isµ"+r+++"--\x3e":"isµ"+r++))})(e,0,s),n=createContent(r,s),i=R(n,129),o=[],a=e.length-1;let c=0,l=`isµ${c}`;for(;c<a;){const t=i.nextNode();if(!t)throw`bad template: ${r}`;if(8===t.nodeType)t.data===l&&(o.push({type:"node",path:createPath(t)}),l="isµ"+ ++c);else{for(;t.hasAttribute(l);)o.push({type:"attr",path:createPath(t),name:t.getAttribute(l)}),t.removeAttribute(l),l="isµ"+ ++c;E.test(t.localName)&&t.textContent.trim()===`\x3c!--${l}--\x3e`&&(t.textContent="",o.push({type:"text",path:createPath(t)}),l="isµ"+ ++c)}}return{content:n,nodes:o}},unroll=(t,{type:e,template:s,values:r})=>{const n=unrollValues(t,r);let{entry:i}=t;i&&i.template===s&&i.type===e||(t.entry=i=((t,e)=>{const{content:s,updates:r}=((t,e)=>{const{content:s,nodes:r}=x.get(e)||x.set(e,mapTemplate(t,e)),n=j(s,!0);return{content:n,updates:r.map(handlers,n)}})(t,e);return{type:t,template:e,content:s,updates:r,wire:null}})(e,s));const{content:o,updates:a,wire:c}=i;for(let t=0;t<n;t++)a[t](r[t]);return c||(i.wire=(t=>{const{firstChild:e,lastChild:s}=t;if(e===s)return s||t;const{childNodes:r}=t,n=[...r];return{ELEMENT_NODE:1,nodeType:111,firstChild:e,lastChild:s,valueOf:()=>(r.length!==n.length&&t.append(...n),t)}})(o))},unrollValues=({stack:t},e)=>{const{length:s}=e;for(let r=0;r<s;r++){const s=e[r];s instanceof P?e[r]=unroll(t[r]||(t[r]={stack:[],entry:null,wire:null}),s):b(s)?unrollValues(t[r]||(t[r]={stack:[],entry:null,wire:null}),s):t[r]=null}return s<t.length&&t.splice(s),s};class P{constructor(t,e,s){this.type=t,this.template=e,this.values=s}}const tag=t=>{const e=new d;return Object.assign(((e,...s)=>new P(t,e,s)),{for(s,r){const n=e.get(s)||e.set(s,new h);return n.get(r)||n.set(r,(e=>(s,...r)=>unroll(e,{type:t,template:s,values:r}))({stack:[],entry:null,wire:null}))},node:(e,...s)=>unroll({stack:[],entry:null,wire:null},new P(t,e,s)).valueOf()})},A=new d,k=tag("html");tag("svg");var $=Object.freeze({__proto__:null,addMatcherToRoute:addMatcherToRoute,addXStateService:function(t,e){return globalThis.__ficusjs__=globalThis.__ficusjs__||{},globalThis.__ficusjs__.xstate=globalThis.__ficusjs__.xstate||{},globalThis.__ficusjs__.xstate[t]=e,e},assign:function(t){return{type:"xstate.assign",assignment:t}},createAppState:createAppState,createCustomElement:function(t,e){const s=function(t){if(!t)return[];const e=[];return Object.keys(t).forEach((s=>{(null==t[s].observed||t[s].observed)&&e.push(toKebabCase(s))})),e}(e.props);globalThis.customElements.get(t)||globalThis.customElements.define(t,class extends globalThis.HTMLElement{static get observedAttributes(){return s}get componentTagName(){return t}connectedCallback(){null==this.connectedCallbackCount&&(this.connectedCallbackCount=0),this.connectedCallbackCount=this.connectedCallbackCount+1,this._checkInit(),this._preprocess()}disconnectedCallback(){"function"==typeof this.removed&&(this.removed(),this.isRemovedCalled=!0)}attributeChangedCallback(){null!=this.connectedCallbackCount&&(this._checkInit(),this._preprocess(),"function"==typeof this.propsDidUpdate&&this.isMountedCalled&&this.propsDidUpdate())}get initialised(){return this._props&&this._computed&&this.templateRenderer}_checkInit(){this.initialised||this._init(e)}_init(e){this.ficusCustomElement=t,this._props=e.props||{},this._computed=e.computed||{},this.computedCache={},this.status="render",this.connectedCallbackCount=0,this.props=this._processProps(),this.root=this._processRoot(e.root),this.slots=this._processSlots(),this.render=e.render||null,this.templateRenderer=e.renderer||elementRenderer,this.template=null,this.created=e.created||null,this.mounted=e.mounted||null,this.updated=e.updated||null,this.removed=e.removed||null,this.propsDidUpdate=e.propsDidUpdate||null,this.isCreatedCalled=!1,this.isMountedCalled=!1,this.isRemovedCalled=!1,this.emit=(t,e)=>{!function(t,e,s={}){const r=Object.assign({},{bubbles:!0,cancelable:!0,composed:!1},s),n=new CustomEvent(e,{bubbles:r.bubbles,cancelable:r.cancelable,composed:r.composed,detail:r.detail});t.dispatchEvent(n)}(this,t,{detail:e})},this._processMethodsAndComputedProps(e),this._processInstanceProps(this._props),"function"!=typeof this.created||this.isCreatedCalled||(this.created(),this.isCreatedCalled=!0)}_processProps(){const t={};return Object.keys(this._props).forEach((e=>{const s={},r=this._props[e],n=this._getAttribute(e);let i=null;if(null!=r.default&&(i=r.default),r.required&&null==n)null!=i?(console.info(`No biggie, the required prop '${e}' has no value set, so the default has been set`),s[e]=i):(s[e]=null,console.error(`The required prop '${e}' has no value set`));else switch(r.type){case String:default:s[e]=n||i;break;case Number:s[e]=null!=n?parseFloat(n):null!=i?i:0;break;case Boolean:s[e]=null!=n?"true"===n.toString():null!=i&&i;break;case Object:try{s[e]=null!=n?JSON.parse(n):null!=i?i:void 0}catch(t){s[e]=null!=i?i:void 0,console.error(`An object prop parse issue occurred with prop ${e} and value ${n}`)}}t[e]=s[e],this._instanceProps&&this._instanceProps[e]&&(t[e]=this._instanceProps[e])})),t}_processMethodsAndComputedProps(t){const e=this,s=Object.keys(t);s.length&&s.forEach((s=>{e[s]||"function"!=typeof t[s]||(e[s]=t[s].bind(e)),"computed"===s&&this._processComputed(t[s])}))}_processRoot(t){switch(t){case"standard":default:return this;case"shadow":return this.attachShadow({mode:"open"});case"shadow:closed":return this.attachShadow({mode:"closed"})}}_processComputed(t){const e=this,s=Object.keys(t);s.length&&s.forEach((s=>{e[s]?console.warn(`Computed property '${s}' already exists on the component instance`):Object.defineProperty(e,s,{get:()=>(e.computedCache[s]||(e.computedCache[s]=t[s].bind(e)()),e.computedCache[s])})}))}_processRender(){const t=this.render?this.render():void 0;t&&(this.template=t,this._updateRender())}_processSlots(){const t=this.childNodes,e={default:[]};return t.length>0&&[...t].forEach((t=>{const s=t.getAttribute?t.getAttribute("slot"):null;s?e[s]=t:e.default.push(t)})),e}_getAttribute(t){try{return this.getAttribute(toKebabCase(t))}catch(t){return console.error("A get prop error occurred",t),""}}_processInstanceProps(t){const e=this,s=Object.keys(t);t&&s.forEach((t=>{let s;e[t]&&(s=e[t],delete e[t]),Object.defineProperty(e,t,{get(){return this._instanceProps&&this._instanceProps[t]?this._instanceProps[t]:this.getAttribute(toKebabCase(t))},set(e){return this._instanceProps||(this._instanceProps={}),this._instanceProps[t]=e,this.setAttribute(toKebabCase(t),"object"==typeof e?JSON.stringify(e):e.toString()),!0},enumerable:!0}),s&&(e[t]=s)}))}_preprocess(){this.computedCache={},this.props=this._processProps(),this._processRender()}_updateRender(){var t;this.template&&("object"!=typeof(t=this.template)&&"function"!=typeof t||"function"!=typeof t.then?(this.templateRenderer(this.template,this.root),this._callLifecycleMethods()):this.template.then((t=>{this.templateRenderer(t,this.root),this._callLifecycleMethods()})).catch((t=>console.error("A component render error occurred",t))))}_callLifecycleMethods(){"function"!=typeof this.mounted||this.isMountedCalled||this.mounted(),this.isMountedCalled=!0,"function"==typeof this.updated&&this.isMountedCalled&&this.updated()}})},createMachine:function(t,e){void 0===e&&(e={});var s=t$1(f$1(r$1(t.states[t.initial].entry).map((function(t){return o$1(t,e.actions)})),t.context,u),2),r=s[0],n=s[1],i={config:t,_options:e,initialState:{value:t.initial,actions:r,context:n,matches:a$1(t.initial)},transition:function(e,s){var r,n,o="string"==typeof e?{value:e,context:t.context}:e,a=o.value,c=o.context,l=u$1(s),u=t.states[a];if(u.on){var h=r$1(u.on[l.type]);try{for(var d=function(t){var e="function"==typeof Symbol&&Symbol.iterator,s=e&&t[e],r=0;if(s)return s.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(h),p=d.next();!p.done;p=d.next()){var f=p.value;if(void 0===f)return c$1(a,c);var _="string"==typeof f?{target:f}:f,m=_.target,g=_.actions,b=void 0===g?[]:g,y=_.cond,v=void 0===y?function(){return!0}:y,S=void 0===m,w=null!=m?m:a,C=t.states[w];if(v(c,l)){var T=t$1(f$1((S?r$1(b):[].concat(u.exit,b,C.entry).filter((function(t){return t}))).map((function(t){return o$1(t,i._options.actions)})),c,l),3),R=T[0],j=T[1],O=T[2],x=null!=m?m:a;return{value:x,context:j,actions:R,changed:m!==a||R.length>0||O,matches:a$1(x)}}}}catch(t){r={error:t}}finally{try{p&&!p.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}}return c$1(a,c)}};return i},createPersist:createPersist,createXStateService:function(t,e,s,r){const n=function(t,e,s){const r=wrapXStateService(function(t){var e=t.initialState,s=l.NotStarted,r=new Set,n={_machine:t,send:function(n){s===l.Running&&(e=t.transition(e,n),l$1(e,u$1(n)),r.forEach((function(t){return t(e)})))},subscribe:function(t){return r.add(t),t(e),{unsubscribe:function(){return r.delete(t)}}},start:function(r){if(r){var i="object"==typeof r?r:{context:t.config.context,value:r};e={value:i.value,actions:[],context:i.context,matches:a$1(i.value)}}else e=t.initialState;return s=l.Running,l$1(e,u),n},stop:function(){return s=l.Stopped,r.clear(),n},get state(){return e},get status(){return s}};return n}(t),e,s);return r}(e,s,r);return globalThis.__ficusjs__=globalThis.__ficusjs__||{},globalThis.__ficusjs__.xstate=globalThis.__ficusjs__.xstate||{},globalThis.__ficusjs__.xstate[t]=n,n},getAppState:getAppState$1,getEventBus:getEventBus,getI18n:function(){return new e},getRouter:getRouter,getXStateService:function(t){if(globalThis.__ficusjs__&&globalThis.__ficusjs__.xstate&&globalThis.__ficusjs__.xstate[t])return globalThis.__ficusjs__.xstate[t]},html:k,renderer:function(t,e){((t,e)=>{const s="function"==typeof e?e():e,r=A.get(t)||A.set(t,{stack:[],entry:null,wire:null}),n=s instanceof P?unroll(r,s):s;n!==r.wire&&(r.wire=n,t.replaceChildren(n.valueOf()))})(e,t)},withI18n:function(t,e){return{...e,created(){this.setI18n(t),e.created&&e.created.call(this)},setI18n(t){const e=this;e._i18n=t,e.i18n={t:(t,s,r)=>e._i18n.t(t,s,r),getLocale:()=>e._i18n.getLocale()}}}},withLocalState:function(t){return{...t,created(){if(t.state&&"function"!=typeof t.state)throw new Error("State must be a function!");this._state=t.state||{},"function"==typeof this._state&&(this._state=this._state.bind(this)()),this.state=this._monitorState(this._state),this.setState=(t,e)=>{const setter=t=>{if(!t||"object"!=typeof t)return;const s=this.updated;e&&(this.updated=()=>{e(),this.updated=s||void 0}),this.status="transaction";for(const e in t)this.state[e]&&this.state[e]===t[e]||(this.state[e]=t[e]);this.status="render",this._processRender()},s=t(this.state);isPromise(s)?s.then(setter):setter(s)},t.created&&t.created.call(this)},_monitorState(t){const e=this;return new Proxy(t,{set:(t,s,r)=>(t[s]===r||(t[s]=r,e.computedCache={},"render"===e.status&&e._processRender()),!0)})}}},withStore:function(t,e){return{...e,created(){this._subscribeCallback=()=>{this.computedCache={},this._processRender()},this.setStore(t),e.created&&e.created.call(this)},mounted(){this._subscribeToStores(!1),e.mounted&&e.mounted.call(this)},updated(){this._subscribeToStores(!1),e.updated&&e.updated.call(this)},removed(){this._unsubscribeFromStores(),e.removed&&e.removed.call(this)},setStore(t){this.store=t,this._subscribeToStores()},_subscribeToStores(t=!0){this.store&&this.store.subscribe&&"function"==typeof this.store.subscribe&&!this.unsubscribe?(this.unsubscribe=this.store.subscribe(this._subscribeCallback),t&&this._subscribeCallback()):this.store&&"object"==typeof this.store&&!this.store.subscribe&&(this.unsubscribe={},Object.keys(this.store).forEach((t=>{this.store[t]&&this.store[t].subscribe&&"function"==typeof this.store[t].subscribe&&!this.unsubscribe[t]&&(this.unsubscribe[t]=this.store[t].subscribe(this._subscribeCallback))})),t&&this._subscribeCallback())},_unsubscribeFromStores(){this.store&&this.unsubscribe&&"object"==typeof this.unsubscribe?(Object.keys(this.unsubscribe).forEach((t=>{this.unsubscribe[t]()})),this.unsubscribe=null):this.store&&this.unsubscribe&&"function"==typeof this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)}}},withXStateService:function(t,e){return{...e,created(){this._subscribeCallback=()=>{this.computedCache={},this._processRender()},this.setXStateService(t),e.created&&e.created.call(this)},mounted(){this._subscribeToFsmService(!1),e.mounted&&e.mounted.call(this)},updated(){this._subscribeToFsmService(!1),e.updated&&e.updated.call(this)},removed(){this._unsubscribeFromFsmService(),e.removed&&e.removed.call(this)},setXStateService(t){this.fsm=t&&t.status!==c.INIT?t:wrapXStateService(t),this._fsmSubscriptionCallback=()=>{this.fsm.status===c.RUNNING&&this._fsmSubscription&&this._subscribeCallback()},this._subscribeToFsmService()},_startFsmService(){this.fsm&&this._fsmSubscription&&this.fsm.status===c.NOT_STARTED&&this.fsm.start()},_subscribeToFsmService(t=!0){this.fsm&&this.fsm.status!==c.INIT&&!this._fsmSubscription&&(this._fsmSubscription=this.fsm.subscribe(this._fsmSubscriptionCallback),t&&this._fsmSubscriptionCallback(),this._startFsmService())},_unsubscribeFromFsmService(){this.fsm&&this.fsm.status!==c.INIT&&this._fsmSubscription&&"function"==typeof this._fsmSubscription&&(this._fsmSubscription(),this._fsmSubscription=null)}}}});const M=Object.freeze({APP_CONFIG:"ficus.app.shell.appConfig",LAYOUT:"ficus.app.shell.layout"});function createError(t,e){const s=Error(t);return s.response=e,s}function handleErrors(t){if(t.ok)return t;if(""!==t.statusText)throw createError(t.statusText,t);const e={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",408:"Request Timeout",409:"Conflict",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Server Unavailable",504:"Gateway Timeout"}[t.status];if(e)throw createError(e,t);throw t}function handleResponses(t){return 204===t.status?null:t.json()}function use(t,{...e}){if(t.create&&"function"==typeof t.create)return t.create({...e,use:use})}function mapRoutesForModules(t){return t&&t.modules?(t.modules=t.modules.map((t=>(t.routes&&(t.routes=t.routes.map((t=>addMatcherToRoute(t)))),t))),t):t}createAppState(M.APP_CONFIG,{initialState:{appConfig:{loaded:!1,data:null,modules:null},error:null},loadAppConfigIfNotLoaded(t){return this.state.appConfig.loaded?Promise.resolve():this.loadAppConfig(t)},loadAppConfig(t){const e=this;return new Promise(((s,r)=>{(function(t,e){return window.fetch(t,{method:"GET",headers:e}).then(handleErrors).then(handleResponses)})(t,{"Content-type":"application/json"}).then((t=>e.loadConfigModules(t))).then((t=>{e.setState((e=>({...e,appConfig:{...e.appConfig,loaded:!0,data:mapRoutesForModules(t)}}))),s()})).catch((t=>r(t)))}))},getModuleUrlByLocation(t){const e=this.state.appConfig.data.modules.find((e=>e.routes.find((e=>e.matcher(t)))));return e?e.moduleUrl:void 0},hasModuleRoutes(){const t=this.state.appConfig.data.modules.filter((t=>t.routes&&t.routes.length>0));return t.length>0},hasModuleMessageBundles(){const t=this.state.appConfig.data.modules.filter((t=>t.messageBundleUrl));return t.length>0},loadConfigModules(t){return Promise.all(t.modules.filter((t=>t.preload)).map((t=>this.loadModuleByModuleUrl(t.moduleUrl)))).then((()=>Promise.resolve(t)))},loadModuleByModuleUrl(t){const e=this,s=e.state.appConfig.data.modules,r=s.find((e=>e.moduleUrl===t));return e.loadModule(r).then((()=>{r.loaded=!0,e.setState((t=>({...t,appConfig:{...t.appConfig,data:{...t.appConfig.data,modules:s}}})))}))},loadModuleByPath(t){const e=this,s=e.state.appConfig.data.modules,r=s.find((e=>e.routes.find((e=>e.path===t))));return e.loadModule(r).then((()=>{r.loaded=!0,e.setState((t=>({...t,appConfig:{...t.appConfig,data:{...t.appConfig.data,modules:s}}})))}))},loadModuleByUrl(t){const e=this,s=e.state.appConfig.data.modules,r=s.find((e=>e.routes.find((e=>e.matcher(t)))));return e.loadModule(r).then((()=>{r.loaded=!0,e.setState((t=>({...t,appConfig:{...t.appConfig,data:{...t.appConfig.data,modules:s}}})))}))},loadModule:t=>t&&t.loaded?Promise.resolve():t?import(t.moduleUrl).then((t=>{use(t.module,$)})):Promise.reject(new Error("Module not found"))}),createAppState(M.LAYOUT,{initialState:{layout:{appbar:!0,navigation:!0},appTitle:null,appVersion:null,pageTitle:{loading:!0,title:null,subtitle:null}},persist:createPersist(M.LAYOUT,"local"),setPageTitle(t){document.title=t}});const N=function(t){if(globalThis.__ficusjs__&&globalThis.__ficusjs__.store&&globalThis.__ficusjs__.store[t])return globalThis.__ficusjs__.store[t]}(M.APP_CONFIG),I=window.ficusShellRuntime&&window.ficusShellRuntime.configUrl||"/app-config.json";N.loadAppConfigIfNotLoaded(I).then((function(){const t=N.hasModuleRoutes(),e=N.hasModuleMessageBundles(),s=t?import("./router-2ae9447d.js"):Promise.resolve(),r=e?import("./i18n-168c7d52.js"):Promise.resolve();return Promise.all([s,r]).then((([t,e])=>{if(t){const e=t.router,s=function(){const t=getAppState$1(M.APP_CONFIG);if(t.state.appConfig.loaded){const e=getRouter(),s=t.getState("appConfig.data.startPath");return e.hasRoute(e.location.pathname)?e.location.pathname:"/"===e.location.pathname&&e.location.pathname!==s?s:e.location.pathname}return"/"}(),r=N.getModuleUrlByLocation(s);r?N.loadModuleByModuleUrl(r).then((()=>e.start(s))):e.start(s)}}))}));export{getAppState$1 as a,createRouter as c,getEventBus as g,M as s};
//# sourceMappingURL=main-d7b7ddad.js.map
